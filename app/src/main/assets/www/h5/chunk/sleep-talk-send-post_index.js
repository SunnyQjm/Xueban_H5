(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{"288":function(e,t,n){"use strict";n.d(t,"c",function(){return delayQuerySelector}),n.d(t,"f",function(){return uuid}),n.d(t,"d",function(){return getEventDetail}),n.d(t,"e",function(){return handleTouchScroll}),n.d(t,"a",function(){return delayGetClientRect}),n.d(t,"b",function(){return delayGetScrollOffset});var o=n(6),a=n(657),r=(n(3),o.a.getEnv());function delay(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;return new Promise(function(t){[o.a.ENV_TYPE.WEB,o.a.ENV_TYPE.SWAN].includes(r)?setTimeout(function(){t()},e):t()})}function delayQuerySelector(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:500,i=r===o.a.ENV_TYPE.WEB?e:e.$scope,l=Object(a.a)().in(i);return new Promise(function(e){delay(n).then(function(){l.select(t).boundingClientRect().exec(function(t){e(t)})})})}function delayGetScrollOffset(e){var t=e.delayTime,n=void 0===t?500:t;return new Promise(function(e){delay(n).then(function(){Object(a.a)().selectViewport().scrollOffset().exec(function(t){e(t)})})})}function delayGetClientRect(e){var t=e.self,n=e.selectorStr,i=e.delayTime,l=void 0===i?500:i,c=r===o.a.ENV_TYPE.WEB||r===o.a.ENV_TYPE.SWAN?t:t.$scope,s=Object(a.a)().in(c);return new Promise(function(e){delay(l).then(function(){s.select(n).boundingClientRect().exec(function(t){e(t)})})})}function uuid(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),o=[],a=0;if(t=t||n.length,e)for(a=0;a<e;a++)o[a]=n[0|Math.random()*t];else{var r=void 0;for(o[8]=o[13]=o[18]=o[23]="-",o[14]="4",a=0;a<36;a++)o[a]||(r=0|16*Math.random(),o[a]=n[19===a?3&r|8:r])}return o.join("")}function getEventDetail(e){var t=void 0;switch(r){case o.a.ENV_TYPE.WEB:t={"pageX":e.pageX,"pageY":e.pageY,"clientX":e.clientX,"clientY":e.clientY,"offsetX":e.offsetX,"offsetY":e.offsetY,"x":e.x,"y":e.y};break;case o.a.ENV_TYPE.WEAPP:t={"pageX":e.target.pageX,"pageY":e.target.pageY,"clientX":e.touches[0].clientX,"clientY":e.touches[0].clientY,"offsetX":e.target.offsetLeft,"offsetY":e.target.offsetTop,"x":e.target.x,"y":e.target.y};break;case o.a.ENV_TYPE.ALIPAY:t={"pageX":e.target.pageX,"pageY":e.target.pageY,"clientX":e.target.clientX,"clientY":e.target.clientY,"offsetX":e.target.offsetLeft,"offsetY":e.target.offsetTop,"x":e.target.x,"y":e.target.y};break;case o.a.ENV_TYPE.SWAN:t={"pageX":e.changedTouches[0].pageX,"pageY":e.changedTouches[0].pageY,"clientX":e.target.clientX,"clientY":e.target.clientY,"offsetX":e.target.offsetLeft,"offsetY":e.target.offsetTop,"x":e.detail.x,"y":e.detail.y};break;default:t={"pageX":0,"pageY":0,"clientX":0,"clientY":0,"offsetX":0,"offsetY":0,"x":0,"y":0},console.warn("getEventDetail暂未支持该环境")}return t}var i=0;function handleTouchScroll(e){r===o.a.ENV_TYPE.WEB&&(e?(i=document.documentElement.scrollTop,document.body.classList.add("at-frozen"),document.body.style.top=-i+"px"):(document.body.style.top=null,document.body.classList.remove("at-frozen"),document.documentElement.scrollTop=i))}},"300":function(e,t,n){"use strict";n(21);var o=n(3),a=n(42),r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},i=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}();var l=function(e){function Textarea(){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Textarea);var e=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(Textarea.__proto__||Object.getPrototypeOf(Textarea)).apply(this,arguments));return e.onChange=e.onChange.bind(e),e.onFocus=e.onFocus.bind(e),e.onBlur=e.onBlur.bind(e),e}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Textarea,o["k"].Component),i(Textarea,[{"key":"onChange","value":function onChange(e){var t=this.props,n=t.onChange,onChange=void 0===n?"":n,o=t.onInput,a=void 0===o?"":o;return Object.defineProperty(e,"detail",{"enumerable":!0,"value":{"value":e.target.value}}),onChange?onChange&&onChange(e):a?a&&a(e):void 0}},{"key":"onFocus","value":function onFocus(e){var onFocus=this.props.onFocus;Object.defineProperty(e,"detail",{"enumerable":!0,"value":{"value":e.target.value}}),onFocus&&onFocus(e)}},{"key":"onBlur","value":function onBlur(e){var onBlur=this.props.onBlur;Object.defineProperty(e,"detail",{"enumerable":!0,"value":{"value":e.target.value}}),onBlur&&onBlur(e)}},{"key":"render","value":function render(){var e=this.props,t=e.className,n=void 0===t?"":t,i=e.placeholder,l=void 0===i?"":i,c=e.disabled,s=e.maxlength,u=void 0===s?140:s,p=e.autoFocus,f=void 0!==p&&p;return o.k.createElement("textarea",r({},Object(a.a)(this.props,["className","placeholder","disabled","maxlength","onChange","onInput","onFocus","onBlur","autofocus"]),{"className":n,"placeholder":l,"disabled":c,"maxlength":u,"autofocus":f,"onChange":this.onChange,"onFocus":this.onFocus,"onBlur":this.onBlur}))}}]),Textarea}();t.a=l},"607":function(e,t,n){},"673":function(e,t,n){"use strict";n.r(t);var o=n(3),a=n(278),r=n(6),i=n(660),l=n(26),c=n(300),s=n(659),u=n(39),p=n(16),f=n(276),d=n(284),h=n.n(d),g=n(11),m=n.n(g),y=n(282),b=n(288),v=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}();function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var k=r.a.getEnv(),P=function(e){function AtImagePicker(){var e,t,n;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,AtImagePicker);for(var o=arguments.length,a=Array(o),i=0;i<o;i++)a[i]=arguments[i];return t=n=_possibleConstructorReturn(this,(e=AtImagePicker.__proto__||Object.getPrototypeOf(AtImagePicker)).call.apply(e,[this].concat(a))),n.chooseFile=function(){var e=n.props,t=e.files,o=void 0===t?[]:t,a=e.multiple,i=e.count,l=e.sizeType,c=e.sourceType,s=k===r.a.ENV_TYPE.ALIPAY?"apFilePaths":"tempFiles",u={};a&&(u.count=99),i&&(u.count=i),l&&(u.sizeType=l),c&&(u.sourceType=c),Object(f.a)(u).then(function(e){var t=e.tempFilePaths.map(function(t,n){return{"url":t,"file":e[s][n]}}),a=o.concat(t);n.props.onChange(a,"add")}).catch(n.props.onFail)},n.handleImageClick=function(e){return n.props.onImageClick(e,n.props.files[e])},n.handleRemoveImg=function(e){var t=n.props.files,o=void 0===t?[]:t;k===r.a.ENV_TYPE.WEB&&window.URL.revokeObjectURL(o[e].url);var a=o.filter(function(t,n){return n!==e});n.props.onChange(a,"remove",e)},_possibleConstructorReturn(n,t)}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(AtImagePicker,y["a"]),v(AtImagePicker,[{"key":"render","value":function render(){var e=this,t=this.props,n=t.className,a=t.customStyle,r=t.files,i=t.mode,c=t.length,u=t.showAddBtn,p=function generateMatrix(e,t,n){for(var o=[],a=n?e.length+1:e.length,r=Math.ceil(a/t),i=0;i<r;i++)if(i===r-1){var l=e.slice(i*t);if(l.length<t){n&&l.push({"type":"btn","uuid":Object(b.f)()});for(var c=l.length;c<t;c++)l.push({"type":"blank","uuid":Object(b.f)()})}o.push(l)}else o.push(e.slice(i*t,(i+1)*t));return o}(r,c,u),f=m()("at-image-picker",n);return o.k.createElement(l.a,{"className":f,"style":a},p.map(function(t,n){return o.k.createElement(l.a,{"className":"at-image-picker__flex-box","key":n},t.map(function(t,a){return t.url?o.k.createElement(l.a,{"className":"at-image-picker__flex-item","key":n*c+a},o.k.createElement(l.a,{"className":"at-image-picker__item"},o.k.createElement(l.a,{"className":"at-image-picker__remove-btn","onClick":e.handleRemoveImg.bind(e,n*c+a)}),o.k.createElement(s.a,{"className":"at-image-picker__preview-img","mode":i,"src":t.url,"onClick":e.handleImageClick.bind(e,n*c+a)}))):o.k.createElement(l.a,{"className":"at-image-picker__flex-item","key":n*c+a},"btn"===t.type&&o.k.createElement(l.a,{"className":"at-image-picker__item at-image-picker__choose-btn","onClick":e.chooseFile},o.k.createElement(l.a,{"className":"add-bar"}),o.k.createElement(l.a,{"className":"add-bar"})))}))}))}}]),AtImagePicker}();P.defaultProps={"isTest":!1,"className":"","customStyle":"","files":[],"mode":"aspectFill","showAddBtn":!0,"multiple":!1,"length":4,"onChange":function onChange(){},"onImageClick":function onImageClick(){},"onFail":function onFail(){}},P.propTypes={"className":h.a.oneOfType([h.a.string,h.a.array]),"customStyle":h.a.oneOfType([h.a.string,h.a.object]),"isTest":h.a.bool,"files":h.a.array,"mode":h.a.oneOf(["scaleToFill","aspectFit","aspectFill","widthFix","top","bottom","center","left","right","top left","top right","bottom left","bottom right"]),"showAddBtn":h.a.bool,"multiple":h.a.bool,"length":h.a.number,"onChange":h.a.func,"onImageClick":h.a.func,"onFail":h.a.func,"count":h.a.number,"sizeType":h.a.array,"sourceType":h.a.array};var S=n(29),_=n(8),E=n(2),T={"dispatchSendPost":function dispatchSendPost(e,t,n){return function(o){return new Promise(function(a,r){o({"type":E.a.GLOBAL.SEND_POST_BEGIN}),function dispatchUpdateImages(e){return new Promise(function(t,n){if(e&&0!==e.length){var o=0,a=[];e.forEach(function(r){_.a.uploadFile(r.file).then(function(n){var r=n.data;"string"==typeof r&&(r=JSON.parse(n.data)),a.push(r.msg.filePath),++o===e.length&&a.length===e.length&&t(a)}).catch(function(e){n(e)})})}else t([])})}(n).then(function(n){return _.a.sendPost(e,t,n)}).then(function(e){o({"type":E.a.GLOBAL.SEND_POST_SUCCESS,"data":{"post":e.postData}}),a(e)}).catch(function(e){console.log(e),o({"type":E.a.GLOBAL.SEND_POST_FAIL}),r(e)})})}}},O=n(279),w=(n(607),n(277)),C=n(19),j=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),x=function get(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var a=Object.getPrototypeOf(e);return null===a?void 0:get(a,t,n)}if("value"in o)return o.value;var r=o.get;return void 0!==r?r.call(n):void 0},N=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e};var Y=function(e){function SleepTalkSendPostPage(e){!function sleep_talk_send_post_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,SleepTalkSendPostPage);var t=function sleep_talk_send_post_possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(SleepTalkSendPostPage.__proto__||Object.getPrototypeOf(SleepTalkSendPostPage)).call(this,e));return t.config={},t.isAnonymous=!1,t.state={"minLen":5,"maxLen":1e3,"value":"","files":[],"previewMarkDown":!1},t.handleSlideRight=t.handleSlideRight.bind(t),t.handleSlideLeft=t.handleSlideLeft.bind(t),t.handleInputChange=t.handleInputChange.bind(t),t.onSendPost=t.onSendPost.bind(t),t.onAnonymousStateChange=t.onAnonymousStateChange.bind(t),t.onChange=t.onChange.bind(t),t}return function sleep_talk_send_post_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(SleepTalkSendPostPage,S["a"]),j(SleepTalkSendPostPage,[{"key":"handleInputChange","value":function handleInputChange(e){this.setState({"value":e.detail.value})}},{"key":"onChange","value":function onChange(e){this.setState({"files":e})}},{"key":"onAnonymousStateChange","value":function onAnonymousStateChange(e){this.isAnonymous=e.selected}},{"key":"onSendPost","value":function onSendPost(){var e=this.state.value;e.length<this.state.minLen||e.length>this.state.maxLen?S.a.waringMessage("字数不符合要求"):this.props.dispatchSendPost(this.state.value,this.isAnonymous,this.state.files).then(function(){C.a.navigateBack().then(function(){S.a.successMessage("帖子发表成功")})})}},{"key":"handleSlideLeft","value":function handleSlideLeft(){this.setState({"previewMarkDown":!0})}},{"key":"handleSlideRight","value":function handleSlideRight(){this.setState({"previewMarkDown":!1})}},{"key":"render","value":function render(){var e=this.state,t=e.minLen,n=e.maxLen,a=e.value,u=e.previewMarkDown,p=this.props,f=p.showLoading,d=p.loadingText,h=w.a.Images,g=h.icon_save,m=h.my_classmates_left,y=h.my_classmates_right,b=a.length;return o.k.createElement(i.a,null,o.k.createElement(O.b,{"title":u?"Markdown预览":"发帖","leftIconVisible":!0}),o.k.createElement(O.j,{"fullScreen":!0,"showLoading":f,"loadingText":d,"onSlideLeft":this.handleSlideLeft,"onSlideRight":this.handleSlideRight},!u&&o.k.createElement(i.a,null,o.k.createElement(l.a,{"className":"send-post-text-body"},o.k.createElement(c.a,{"placeholder":"说点什么吧...","className":"send-post-text-area","autoFocus":!0,"autoHeight":!0,"maxlength":n,"onInput":this.handleInputChange,"value":a}),o.k.createElement(l.a,{"className":"send-post-limit-text","style":"color: "+(b>=t&&b<=n?"grey":"red")},b+" / "+t+"-"+n)),o.k.createElement(P,{"files":this.state.files,"onChange":this.onChange.bind(this),"customStyle":"\n              background-color: #fff;\n              padding-bottom: "+r.a.pxTransform(20)+"\n              "}),o.k.createElement(l.a,{"className":"divider-line"}),o.k.createElement(O.w,{"onSelectedChange":this.onAnonymousStateChange,"mode":1,"title":"匿名","showIcon":!1}),o.k.createElement(l.a,{"className":"float-opt float-opt-right"},o.k.createElement(s.a,{"className":"float-opt-image","src":y,"mode":"aspectFit","onClick":this.handleSlideLeft}))),u&&o.k.createElement(i.a,null,o.k.createElement(O.y,{"richText":a,"type":"markdown","raw":!1,"customStyle":"padding: "+r.a.pxTransform(20)}),o.k.createElement(l.a,{"className":"float-opt float-opt-left"},o.k.createElement(s.a,{"className":"float-opt-image","src":m,"mode":"aspectFit","onClick":this.handleSlideRight})))),o.k.createElement(O.n,{"onClick":this.onSendPost,"icon":g,"backgroundColor":"#fff"}))}},{"key":"componentDidMount","value":function componentDidMount(){x(SleepTalkSendPostPage.prototype.__proto__||Object.getPrototypeOf(SleepTalkSendPostPage.prototype),"componentDidMount",this)&&x(SleepTalkSendPostPage.prototype.__proto__||Object.getPrototypeOf(SleepTalkSendPostPage.prototype),"componentDidMount",this).call(this)}},{"key":"componentDidShow","value":function componentDidShow(){x(SleepTalkSendPostPage.prototype.__proto__||Object.getPrototypeOf(SleepTalkSendPostPage.prototype),"componentDidShow",this)&&x(SleepTalkSendPostPage.prototype.__proto__||Object.getPrototypeOf(SleepTalkSendPostPage.prototype),"componentDidShow",this).call(this)}},{"key":"componentDidHide","value":function componentDidHide(){x(SleepTalkSendPostPage.prototype.__proto__||Object.getPrototypeOf(SleepTalkSendPostPage.prototype),"componentDidHide",this)&&x(SleepTalkSendPostPage.prototype.__proto__||Object.getPrototypeOf(SleepTalkSendPostPage.prototype),"componentDidHide",this).call(this)}}]),SleepTalkSendPostPage}();Y.defaultProps={},Y=a.a([Object(u.b)(function mapStateToProps(e){return N({},e.SleepTalkSendPostReducer.toJS())},function mapDispatchToProps(e){return N({},Object(p.b)(T,e))})],Y);t.default=Y}}]);